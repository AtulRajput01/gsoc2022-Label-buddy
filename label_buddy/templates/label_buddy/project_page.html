{% extends 'base.html' %}

{% load static%}

{% load crispy_forms_tags %}

{% block head_files %}
    {{ block.super }}
    <link href="{% static 'css/project_page.css' %}" rel="stylesheet" type="text/css">
    <script src="{% static '/js/project_page.js'%}"></script>
{% endblock %}

{% block title %} &#9702; {{project.title}} {% endblock %}

{% block navbar_buttons %}
    <a title="Project instructions" style="margin-top: .7%;" class="my-button-page my-link" data-toggle="modal" data-target="#instructionsModal" href=""><i class="fas fa-info"></i></a>
    <a title="Project description" style="margin-top: .7%;" class="my-button-page my-link" data-toggle="modal" data-target="#descriptionModal" href=""><i class="fas fa-question-circle"></i></a>
{% endblock %}

{% block content %}
    
    {% if tasks_count > 0 %}
        <h1 style="text-align:center">Tasks for {{ project.title }}</h1>
        {% if user in project.managers.all%}
            <a data-toggle="modal" data-target="#importModal" href="">
                <button class="btn my-button my-button-page">Import</button>
            </a>
            <a href="{% url 'edit_project' project.id %}">
                <button style="margin-right: .1%;" class="btn my-button my-button-page">Edit</button>
            </a>
            <div class="dropdown show">
                <a style="margin-right: .1%; color: black;" class="btn my-button my-button-page" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i style="margin-right: 10%;" class="fas fa-filter"></i> Filters
                </a>
              
                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                    <div style="margin-left: 10%;" class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="labeled">
                        <label class="form-check-label" for="flexCheckDefault">
                          Labeled
                        </label>
                    </div>
                    <div style="margin-left: 10%;" class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="unlabeled">
                        <label class="form-check-label" for="flexCheckChecked">
                          Unlabeled
                        </label>
                    </div>
                    <div class="dropdown-divider"></div>
                    <div style="margin-left: 10%;" class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="reviewed">
                        <label class="form-check-label" for="flexCheckDefault">
                            Reviewed
                        </label>
                    </div>
                    <div style="margin-left: 10%;" class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="unreviewed">
                        <label class="form-check-label" for="flexCheckChecked">
                            Unreviewed
                        </label>
                    </div>
                    <div class="dropdown-divider"></div>
                    <a onclick="filter_tasks()" style="text-align: center;" class="dropdown-item" href="javascript:void(0);"><b>Filter</b></a>
                </div>
              </div>
        {% else %}
            <button class="btn my-button my-button-page"><i style="margin-right: 10%;" class="fas fa-filter"></i> Filters</button>
        {% endif %}
        <div class="my-custom-scrollbar table-wrapper-scroll-y">
            <!--Table-->
            <table class="table table-bordered table-hover">
            <!--Table head-->
            <thead>
                <tr>
                    <th title="Task ID"><i class="fas fa-hashtag my-table-header"></i> ID</th>
                    <th><i class="fa fa-paint-brush my-table-header" aria-hidden="true"></i> Annotations completed</th>
                    <th><i class="fas fa-users my-table-header"></i> Annotated by</th>
                    <th><i class="fas fa-file-audio my-table-header"></i> Audio file</th>
                    <th><i class="fas fa-check-circle my-table-header"></i> Status</th>
                    <th><i class="fas fa-check-circle my-table-header"></i> Review status</th>
                </tr>
            </thead>
            <!--Table head-->
            {% for task in tasks %}
                <!--Table body-->
                <tbody>
                    <tr class="clickable-row" href="{% url 'annotation_page' project.id task.id %}">
                        <td>{{ forloop.counter }}</td>
                        <td><b>{{ count_annotations_for_task|get_item:task.id }}</b></td>
                        <td>
                            {% if users_annotated|get_item:task.id%}
                                {% for obj in users_annotated|get_item:task.id %}
                                    {% if obj.avatar %}
                                        {% if obj == user %}
                                            <img style="border: 2px solid #74deed;" src="{{ obj.avatar.url }}" width="27" height="27" title="You" class="rounded-circle">
                                        {% else %}
                                            <img src="{{ obj.avatar.url }}" width="25" height="25" title="{{ obj.username }}" class="rounded-circle">
                                        {% endif %}
                                    {% else %}
                                        {% if obj == user%}
                                            <img style="border: 2px solid #74deed;" src="{% static '/images/user/user.jpg' %}" width="27" height="27" title="You" class="rounded-circle">
                                        {% else %}
                                            <img src="{% static '/images/user/user.jpg' %}" width="25" height="25" title="{{ obj.username }}" class="rounded-circle">
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <b>No annotations done yet</b>
                            {% endif %}
                        </td>
                        <td>
                            {% if task.file %}
                                <audio title="{{ task.file }}" class="audio-player" controls
                                    src="{{ task.file.url }}">
                                        Your browser does not support the
                                        <code>audio</code> element.
                                </audio>
                            {% else %}
                                <p>No audio yet</p>
                            {% endif %}
                        </td>
                        <td>{{ task.status }}</td>
                        <td>{{ task.review_status }}</td>
                    </tr>
                </tbody>
                <!--Table body-->
            {% endfor %}
        </table>
    {% else %}
        <div class="center-screen">
            <p>No tasks for {{ project.title }}. Please <a class="my-link" data-toggle="modal" data-target="#importModal" href="">import</a> some data.
            </p>
        </div>
    {% endif%}

    {% include "project_modals.html" %}

    <!-- Import Modal -->
    <div class="modal fade" id="importModal" tabindex="-1" role="dialog" aria-labelledby="importModal" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Import data</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <p>This file is for the annotation process. The accepted formats are: <b>.wav, .mp3 and .mp4</b></p>
            <div class="modal-body">
                <form enctype="multipart/form-data" action="" method="POST">
                    {% csrf_token %}
                    {{ task_form | crispy}}
                    <button id="import-btn" class="btn my-button" type="submit">Upload</button>
                </form>
            </div>
        </div>
        </div>
    </div>
    
{% endblock %}